<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinanSalud - Perfil</title>

    <link rel="stylesheet" href="/css/theme.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-light">
<div id="header-placeholder"></div>
<div class="container">
    <div class="dashboard-grid">
        <!-- Profile Section -->
        <div class="card profile-card">
            <div class="profile-image">
                <img id="profile-pic" src="/uploads/profile-pics/profile-pic.jpg" alt="Foto de perfil" class="profile-pic">                <input type="file" id="upload-profile-pic" accept="image/*" style="display: none;">
            </div>
            <button class="btn btn-secondary mt-2" id="change-pic-btn">Cambiar imagen</button>
            <h2 class="profile-name" id="profile-username">Cargando...</h2>
            <p class="profile-email">anabombardini@gmail.com</p>
        </div>

        <!-- Cards Section -->
        <div class="card cards-card">
            <h2 class="section-title">Mis tarjetas</h2>
            <div class="cards-container">
                <button class="nav-btn prev-btn">&lt;</button>
                <div class="credit-card">
                    <div class="credit-card-header">
                        <span class="credit-card-type">VISA</span>
                    </div>
                    <div class="credit-card-body">
                        <div class="credit-card-number">1234 5678 6543 4321</div>
                        <div class="credit-card-footer">
                            <span class="credit-card-holder">JACK SPARROW</span>
                            <span class="credit-card-expiry">02/25</span>
                        </div>
                    </div>
                </div>
                <button class="nav-btn next-btn">&gt;</button>
            </div>
            <button class="btn btn-primary w-50 mx-auto d-block">Añadir</button>        </div>

        <!-- Information Section -->
        <div class="card info-card">
            <h2 class="section-title">Información general</h2>
            <div class="info-list">
                <div class="info-item">
                    <span class="info-label">Presupuesto del mes:</span>
                    <span class="info-value">€1350,32</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Ingresos totales:</span>
                    <span class="info-value">€1109,15</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Gastos totales:</span>
                    <span class="info-value">€759,91</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Ahorro total:</span>
                    <span class="info-value">€759,91</span>
                </div>
            </div>
        </div>

        <!-- Analysis Section -->
        <div class="card analysis-card">
            <h2 class="section-title">Análisis básico</h2>
            <div class="analysis-content">
                <div class="analysis-item">
                    <h3 class="analysis-title">Tasa de ahorro</h3>
                    <p class="analysis-value">€759,91 / €1109,15 = 68.5%</p>
                </div>
                <div class="analysis-item">
                    <h3 class="analysis-title">Gastos vs. presupuesto</h3>
                    <p class="analysis-value">€759,91 / €1350,32 = 56.3%</p>
                </div>

            </div>
        </div>

        <!-- Chart Section -->
        <div class="card chart-card">
            <h2 class="section-title">Recomendación financiera</h2>
            <button id="btn-recomendacion" class="btn btn-success mb-2">Obtener recomendación</button>
            <div id="recomendacion-financiera" class="alert alert-info mt-2" style="display:none;"></div>
        </div>
    </div>
</div>


<div id="navigation-container"></div>
<script>
    // Cargar el header dinámicamente
    fetch('/header')
        .then(response => response.text())
        .then(data => {
            document.getElementById('header-placeholder').innerHTML = data;
            // Actualizar título y subtítulo después de cargar el header
            document.getElementById('page-title').textContent = 'Tus activos financieros';
            document.getElementById('page-subtitle').textContent = 'Gestiona tus inversiones';

            // Inicializar el script del header después de que se haya cargado
            const now = new Date();
            const options = { month: 'long', year: 'numeric' };
            const currentMonthElement = document.getElementById('current-month');
            if (currentMonthElement) {
                currentMonthElement.textContent = now.toLocaleDateString('es-ES', options)
                    .replace(/^\w/, c => c.toUpperCase());
            }
        })
        .catch(error => console.error('Error al cargar el header:', error));
</script>
<script>
    document.getElementById('btn-recomendacion').addEventListener('click', function() {
        const recomendacionDiv = document.getElementById('recomendacion-financiera');
        recomendacionDiv.style.display = 'block';
        recomendacionDiv.textContent = 'Cargando recomendación...';

        fetch('/chat/finanzas')
            .then(response => response.json())
            .then(data => {
                if (data.response) {
                    recomendacionDiv.textContent = data.response;
                } else {
                    recomendacionDiv.textContent = 'No se pudo obtener la recomendación.';
                }
            })
            .catch(() => {
                recomendacionDiv.textContent = 'Error al conectar con el servidor.';
            });
    });
</script>
<script>
    fetch('/user/me')
        .then(response => response.json())
        .then(data => {
            document.getElementById('profile-username').textContent = data.username;
            const profilePic = document.getElementById('profile-pic');
            if (data.profileImageUrl) {
                profilePic.src = data.profileImageUrl + '?t=' + new Date().getTime();
            }
        })
        .catch(() => {
            document.getElementById('profile-username').textContent = 'Usuario';
        });
</script>
<script>
    // Cargar el componente de navegación
    fetch('/navigation-bar')
        .then(response => response.text())
        .then(data => {
            document.getElementById('navigation-container').innerHTML = data;
        });
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const profilePic = document.getElementById('profile-pic');
        const uploadInput = document.getElementById('upload-profile-pic');
        const changePicBtn = document.getElementById('change-pic-btn');

        changePicBtn.addEventListener('click', () => {
            uploadInput.click();
        });

        uploadInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const formData = new FormData();
                formData.append('file', file);

                fetch('/api/user/upload-profile-pic', {
                    method: 'POST',
                    body: formData
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            profilePic.src = data.imageUrl + '?t=' + new Date().getTime();
                        } else {
                            alert('Error al subir la imagen: ' + data.message);
                        }
                    })
                    .catch(() => {
                        alert('Error al conectar con el servidor.');
                    });
            }
        });
    });
</script>
</body>
</html>
